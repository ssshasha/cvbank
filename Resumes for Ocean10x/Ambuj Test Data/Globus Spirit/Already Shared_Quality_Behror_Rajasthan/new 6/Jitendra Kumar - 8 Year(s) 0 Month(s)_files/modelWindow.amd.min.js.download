define(["exports"],function(a){"use strict";function b(a){return $.expr.filters.visible(a)&&!$(a).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}function c(a,c){var d,e,f,g=a.nodeName.toLowerCase();return"area"===g?(d=a.parentNode,e=d.name,a.href&&e&&"map"===d.nodeName.toLowerCase()?(f=$("img[usemap=#"+e+"]")[0],!!f&&b(f)):!1):(/input|select|textarea|button|object/.test(g)?!a.disabled:"a"===g?a.href||c:c)&&b(a)}function d(){var a=this.options.open.minZIndex;return $(".ltCont .ltLayer").each(function(){var b=parseInt($(this).css("z-index"));b>a&&(a=b)}),a}var e={modalOpen:"modalOpen"},f=function(a,b){var c=void 0;return c=-1!=a.indexOf("?")?a+"&action="+b:a+"?action="+b},g=function(){return f(""+document.location.pathname+document.location.search,e.modalOpen)},h=function(a){return a.replace(/[&]?action=(drawerOpen|modalOpen)[&]?/g,"").replace(/^[?]$/,"")},i=function(a){},j=window.interfaces&&window.interfaces.page||window.page||i,k=(function(){function a(a){this.value=a}function b(b){function c(a,b){return new Promise(function(c,e){var h={key:a,arg:b,resolve:c,reject:e,next:null};g?g=g.next=h:(f=g=h,d(a,b))})}function d(c,f){try{var g=b[c](f),h=g.value;h instanceof a?Promise.resolve(h.value).then(function(a){d("next",a)},function(a){d("throw",a)}):e(g.done?"return":"normal",g.value)}catch(i){e("throw",i)}}function e(a,b){switch(a){case"return":f.resolve({value:b,done:!0});break;case"throw":f.reject(b);break;default:f.resolve({value:b,done:!1})}f=f.next,f?d(f.key,f.arg):g=null}var f,g;this._invoke=c,"function"!=typeof b["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=function(){return this}),b.prototype.next=function(a){return this._invoke("next",a)},b.prototype["throw"]=function(a){return this._invoke("throw",a)},b.prototype["return"]=function(a){return this._invoke("return",a)},{wrap:function(a){return function(){return new b(a.apply(this,arguments))}},await:function(b){return new a(b)}}}(),Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}),l=[],m=null,n=-1,o="forward",p={route:null},q=function(){m?(m(),m=null):l.length&&l.shift().close()},r=function(a){return void 0!=a.state.modalSlideCount?(o=n<a.state.modalSlideCount?"forward":"backward",n=a.state.modalSlideCount):(o="forward",setTimeout(function(){a.state.modalSlideCount=++n,a.save()},0)),o},s=function(){j("*",function(a,b){a.querystring.match(/[&?]*action=modalOpen/)?"backward"==r(a)&&q():b()})},t=function(a){setTimeout(function(){var b=g();if(a.options.close&&a.options.close.replaceRoute){var c=a.options.close.replaceRoute;j.redirect(c),setTimeout(function(){j(b),l.unshift(a)},100)}else j(b),l.unshift(a)},0)},u=function(a){return k({},a,{open:k({},a.open,{success:function(){if(a.open&&a.open.success){var b;(b=a.open.success).call.apply(b,[this].concat(Array.prototype.slice.call(arguments)))}t(this)}}),close:k({},a.close,{success:function(b){var c=this;if(b){var d=new Promise(function(a,b){m=a,l.shift(),window.history.back()});d.then(function(d){a.close&&a.close.success&&a.close.success.call(c,b)})}else a.close&&a.close.success&&a.close.success.call(this,b)}})})},v=function(a){a.subscribe(function(){var b=a.getState();b.route!=p.route&&(b.route.back&&q(),p.route=b.route)})},w=window.screen.width<=767,x=function(){var a=$('<div class="ltCont close"></div>').attr("tabIndex",0),b=$('<div class="ltLayer close"></div>'),d=[];return a.append(b),$(window).bind("resize",function(){if(d.length){var a=d[0];a.resize()}}),$("html").keydown(function(a){27===a.keyCode&&d.length&&d[0].options.close.esc&&(d[0].close_target=a,d[0].close())}),b.click(function(a){a.stopPropagation(),d[0].close_target=this,d.length&&d[0].options.close.layer&&d[0].close()}),w||($.expr[":"].focusable||($.expr[":"].focusable=function(a){return c(a,!isNaN($.attr(a,"tabindex")))}),a.keydown(function(a){if(d.length&&9===a.keyCode){var b=d[0].options.model.find(":focusable"),c=b.first(),e=b.last();return a.target!==e[0]&&a.target!==a.currentTarget||a.shiftKey?a.target!==c[0]&&a.target!==a.currentTarget||!a.shiftKey?void a.stopPropagation():(e?e.focus():"",!1):(c?c.focus():"",!1)}})),$("html").keydown(function(b){return 9===b.keyCode&&!w&&d.length?(a.focus(),!1):void 0}),$(function(){$("body").append(a)}),{stack:d,cont:a,layer:b}},y=function(){var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var b in a)if(void 0!==document.documentElement.style[b])return a[b];return null}(),z={is_options_valid:function(a){return a&&a.model&&1===a.model.prop("nodeType")?!0:!1},switchClass:function(a,b){a&&this.removeClass(a),b&&this.addClass(b)}},A=function(a,b){var c=this;window.requestAnimationFrame(function(){z.switchClass.call(c,a,b)})},B={trigger:null,routing:!0,model:null,dir:"",dimens:{height:"auto",width:"auto"},resetForm:!1,fixed:!1,zLayer:!0,open:{minZIndex:999,success:function(){},event:"click",selector:null,anim:""},close:{esc:!0,layer:!0,nodes:{target:"",event:"click",selector:""},success:function(){},returnFocus:!0,anim:"",replaceRoute:""}},C=null,D=function(){this.options.model.css({position:this.options.fixed?"fixed":"absolute",width:this.options.dimens.width,height:this.options.dimens.height})},E=function(a){this.options=$.extend(!0,{},this.default_opt,a)},F=function(){var a=this.options.model.parent();a.hasClass("ltCont")||(this.options.model.addClass(this.options.dir),C.cont.append(this.options.model))},G={open:function(){var a=[this.options.close.anim,this.options.open.anim];A.apply(this.options.model,a)},close:function(a){var b=[this.options.open.anim,this.options.close.anim];A.apply(this.options.model,b)}},H=function(){var a=document.documentElement.scrollTop,b=this.options.open.firstFocus;b?b.focus():C.cont.focus(),document.documentElement.scrollTop=a},I=function(){if(this.options.resetForm)for(var a=this.options.model.find("form"),b=0;b<a.length;b++)a[b].reset()},J=function(){if(!C.stack.length){var a=this.options.close.returnFocus;a===!0?this.options.trigger.focus():$(a).focus()}},K=function(){if(0==this.transEndCbFired){if(this.transEndCbFired=!0,this.options.model.removeClass("model_open"),C.stack.length){var a=C.stack[0];this.options.zLayer&&C.layer.css("zIndex",a.options.model.css("zIndex"))}else C.cont.addClass("close");J.call(this),I.call(this),this.options.close.success.call(this,this.close_target)}},L=function(){var a=this;a.state="close",this.openEventHandler=function(){a.open()},this.options.trigger.on(this.options.open.event+"."+this.pluginName,this.options.open.selector,this.openEventHandler),M.call(this,this.options.close.nodes)},M=function ha(a){var b=this;if("array"===$.type(a))return void $.each(a,function(a,c){ha.call(b,c)});var c=null;a.constructor===jQuery?(c=$.extend({},this.default_opt.close.nodes),c.target=a):c={target:$(a.target),event:a.event,selector:a.selector},c.target.on(c.event,c.selector,function(){b.close(),b.close_target=this})},N=function(a){E.call(this,a),this.init_structure(),D.call(this),L.call(this),this.options.model.addClass(this.options.close.anim),this.options.routing&&(this.options=u(this.options))},O=function(a){this.options.trigger.off(this.options.open.event+"."+this.pluginName)},P=function(){this.options.trigger.off(this.options.open.event,this.openEventHandler)},Q=function(){this.options.trigger.on(this.options.open.event,this.openEventHandler)},R=function(){C.cont.css({width:"auto",height:"auto"});var a=$(document).height(),b=$(document).width();C.cont.css({width:b+"px",height:a+"px"})},S=function(){this.close_target=null,this.transEndCbFired=!1,this.state="open",this.options.model.addClass("model_open"),this.options.model.data("model",this);var a=d.call(this);this.options.zLayer&&C.layer.css("zIndex",a+3),this.options.model.css("zIndex",a+3),C.stack.length||(C.cont.css("zIndex",a+1),A.call(C.layer,"close","open"),C.cont.removeClass("close")),I.call(this),-1===$.inArray(this,C.stack)&&C.stack.unshift(this),this.resize(),G.open.call(this),H.call(this),this.options.open.success.call(this)},T=function(a,b){a=a||$(C.stack).index(this),!C.stack.length||0>a||(this.state="close",this.options.model.data("model",this),C.stack.splice(a,1),y&&!b&&this.options.open.anim?G.close.call(this):K.call(this),C.stack.length||A.call(C.layer,"open","close"))},U=function(a){function b(a,b){this.close_target=null;var c=b.data("model");c&&c.options&&c.options.model[0]===a.model[0]&&O.call(c),a.trigger=b,N.call(this,a)}var c=function(){};c.prototype=X;var d=new c;return d.pluginName=a,b.prototype=d,b},V=function(){this.off(),T.call(this,void 0,!0),C.stack.length||(A.call(C.layer,"open","close"),C.cont.addClass("close")),this.options.model.remove()},W=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{store:null};C||(C=X.lt=x()),a.store&&(v(a.store),s())},X={isTransitionEndSupported:y,transEndCbFired:!1,pluginName:"",state:"close",util:z,lt:C,reInit:O,close_returnFocus:J,getNewModel:U,open:S,close:T,on:Q,off:P,resize:R,default_opt:B,init_structure:F,closeTransEnd_cb:K,destroy:V},Y=window.jQuery||window.Zepto,Z="lightBox",_=null,aa=function(){return _||(_=U(Z),_.prototype.resize=function(){R();var a=document.documentElement||document.body,b=Y(window).height(),c=Y(window).width(),d=window.pageYOffset?pageYOffset:a.scrollTop,e=b-this.options.model.height(),f=0,g=c-this.options.model.width(),h=0;return e>0?f=(this.options.fixed?0:d)+e/2:(f=0,window.scrollTo(0,f)),h=g>0?g/2:0,this.options.model.css({top:f+"px",left:h+"px"}),!0}),_},ba=function(a){var b,c=null,d=null;if(a)try{if(b=a.model,a.model=a.ltBox,a.ltBox=null,!a.model)throw b}catch(e){a.model=e}if(z.is_options_valid(a)){if(a.open)try{if(b=a.open.anim,b&&!(a.open.anim=a.open.anim.className))throw b}catch(e){a.open.anim=e}if(a.close)try{if(b=a.close.anim,b&&!(a.close.anim=a.close.anim.className))throw b}catch(e){a.close.anim=e}var f=aa();c=new f(a,a.trigger),d={resize:function(){c.resize()},open:function(){c.open()},close:function(a,b){c.close(a,b)},on:function(){c.on()},off:function(){c.off()},destroy:function(){c.destroy()}},a.trigger.data("model",d);var g=a.model;g.on(y,function(a){a.target==g[0]&&g.hasClass(c.options.close.anim)&&c.closeTransEnd_cb.call(c)})}return a.trigger.data("model")||c},ca="drawer",da={fixed:!0,dir:"right",open:{anim:"sideIn"},close:{anim:"sideOut"}},ea=null,fa=function(){return ea||(ea=U(ca)),ea},ga=function(a){var b=null,c=null;if(a=k({},da,a),z.is_options_valid(a)){var d=fa();b=new d(a,a.trigger),c={resize:function(){b.resize()},open:function(){b.open()},close:function(a,c){b.close(a,c)},on:function(){b.on()},off:function(){b.off()},destroy:function(){b.destroy()}},a.trigger.data("model",c);var e=a.model;e.on(y,function(a){a.target==e[0]&&e.hasClass(b.options.close.anim)&&b.closeTransEnd_cb.call(b)})}return a.trigger.data("model")||b};a.lightBox=ba,a.drawer=ga,a.modelSetup=W,a.cleanQueryString=h,Object.defineProperty(a,"__esModule",{value:!0})});