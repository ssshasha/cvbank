!function(a,b,c,d){var e=function(d,e){this.elem=d,this.$elem=a(d),this.options=e,this.metadata=this.$elem.data("plugin-options"),this.$win=a(b),this.sections={},this.didScroll=!1,this.$doc=a(c),this.docHeight=this.$doc.height()};e.prototype={defaults:{navItems:"a",currentClass:"current",changeHash:!1,easing:"swing",filter:"",scrollSpeed:750,scrollThreshold:.5,begin:!1,end:!1,scrollChange:!1,hideAfterLastBlock:!1,topContId:"nav-anchor",navContId:"nav"},init:function(){this.config=a.extend({},this.defaults,this.options,this.metadata),this.$nav=this.$elem.find(this.config.navItems),""!==this.config.filter&&(this.$nav=this.$nav.filter(this.config.filter)),this.$nav.on("click.onePageNav",a.proxy(this.handleClick,this)),this.getPositions(),this.bindInterval(),this.$win.on("resize.onePageNav",a.proxy(this.getPositions,this));for(var b in this.sections)this.sections.hasOwnProperty(b)&&(this.lastSection=b);return this},makeSticky:function(){var b=this.$win.scrollTop()+this.config.topLimitForNav(),c=a("#"+this.config.topContId).offset().top;b>=c?(a("#"+this.config.navContId).css("display","block"),a("#"+this.config.navContId).addClass("fixed")):b<=c&&a("#"+this.config.navContId).removeClass("fixed")},adjustNav:function(a,b){a.$elem.find("."+a.config.currentClass).removeClass(a.config.currentClass),b.addClass(a.config.currentClass)},bindInterval:function(){var a,b=this;b.$win.on("scroll.onePageNav",function(){b.didScroll=!0}),b.t=setInterval(function(){a=b.$doc.height(),b.didScroll&&(b.didScroll=!1,b.scrollChange()),a!==b.docHeight&&(b.docHeight=a,b.getPositions())},1)},getHash:function(a){return a.attr("href").split("#")[1]},getPositions:function(){var b,c,d,e=this;e.$nav.each(function(){b=e.getHash(a(this)),d=a("#"+b),d.length&&(c=d.offset().top,e.sections[b]=Math.round(c))})},getSection:function(b){var c=null,d=Math.round(this.$win.height()*this.config.scrollThreshold()),e=0;this.config.addThreshHold&&(e+=90);for(var f in this.sections)this.sections[f]-d<b+e&&(c=f);return c==this.lastSection&&b>=this.sections[f]+a("#"+c).outerHeight(!0)/2&&(c="afterLast"),c},handleClick:function(c){var d=this,e=a(c.currentTarget),f=e.parent(),g="#"+d.getHash(e);f.hasClass(d.config.currentClass)||(d.config.begin&&d.config.begin(),d.scrollTo(g,function(){d.config.changeHash&&(b.location.hash=g),d.bindInterval(),d.config.end&&d.config.end()})),c.preventDefault()},scrollChange:function(){this.makeSticky();var b,c=this.$win.scrollTop(),d=this.getSection(c);null!==d&&"afterLast"!=d?(b=this.$elem.find('a[href$="#'+d+'"]').parent(),b.hasClass(this.config.currentClass)||(this.adjustNav(this,b),this.config.scrollChange&&this.config.scrollChange(b))):(this.$elem.find("."+this.config.currentClass).removeClass(this.config.currentClass),this.config.hideAfterLastBlock&&"afterLast"==d&&a("#"+this.config.navContId).css("display","none"))},scrollTo:function(b,c){var d=a(b).offset().top,e=0;this.config.addThreshHold&&(e=this.config.getThreshold()),a("html, body").animate({scrollTop:d-this.config.topLimitForContent()-e},this.config.scrollSpeed,this.config.easing,c)},unbindInterval:function(){clearInterval(this.t),this.$win.unbind("scroll.onePageNav")}},e.defaults=e.prototype.defaults,a.fn.onePageNav=function(a){return this.each(function(){new e(this,a).init()})}}(jQuery,window,document);